# README: Network Inference üìä

This directory contains R and bash scripts for the inference of microbial association networks using the `NetCoMi` R package. The scripts are designed to work with microbiome data, specifically focusing on different biomes and taxonomic ranks (species and genus). The primary goal is to facilitate the construction of microbial interaction networks from processed `phyloseq` objects.

---

## Folder Structure üìÇ

* **`Bash_scripts/`**: This directory holds **BSUB job submission scripts** used for running the R scripts on a cluster environment (e.g., LSF system). These scripts configure job resources and execute the R analysis. Each R network building script has corresponding Bash scripts for different biomes or parameters, organized in subfolders within `Bash_scripts/` (e.g., `Bash_scripts/PGE_sp/`, `Bash_scripts/NOPGE_gen/`).

* **Other `.R` files**: These are the core R scripts detailed in the following sections.

---

## Script Descriptions

### Network Building & Preparation

* **`Create_phyloseq_object.R`**: This script **processes raw sequencing data** (metadata, abundance, and taxonomic tables) from specified input folders. It **transforms these data into `phyloseq` objects**, which are standard R objects for microbiome data analysis, and then **saves these `phyloseq` objects** as `.rds` files. It specifically handles data from `PGE_Species`, `NOPGE_Species`, `PGE_Genus`, and `NOPGE_Genus` folders.

* **`Create_phyloseq_objects_bybiome.R`**: This script **iterates through each biome subdirectory** found in the `Data` folder. For each biome, it **loads the metadata, abundance, and taxonomic tables**, **processes them into a `phyloseq` object**, and then **saves the resulting `phyloseq` object** specific to that biome.

* **`Build_microb_net.R`**: This script **constructs microbial interaction networks** using the `NetCoMi` R package. It supports **`cclasso` and `spring` network inference methods**. It takes a single `phyloseq` object as input and **saves the generated `microNet` object** (an R object representing the network) as an `.rds` file, along with its **edgelist as a `.csv` file**. This script is configured for `PGE`, `NO_PGE`, `PGE_NOPGE_sp`, and `PGE_NOPGE_gen` biomes.

* **`Build_microb_net_sp_gen.R`**: This script also **builds microbial interaction networks** using `NetCoMi` with `cclasso` or `spring` methods. It specifically **determines the taxonomic rank (`Species_Name` or `Genus_Name`) for network construction based on the input biome name** (e.g., `PGE_sp`, `NOPGE_sp`, `PGE_gen`, `NOPGE_gen`). It **saves the `microNet` object and its edgelist**.

* **`Build_microb_nets_based_on_groups.R`**: This script **infers a combined microbial network** by taking **two separate `phyloseq` objects** (e.g., `PGE_phyloseqfile_filtered.rds` and `NO_PGE_phyloseqfile_filtered.rds`) as input. It **constructs a joint network** using `NetCoMi` and **saves the resulting `microNet` object and its edgelist**.

---

## üö¶ Running Order for Network Inference

Follow these steps to generate your microbial interaction networks:

1.  **Prepare `phyloseq` Objects:**
    * Run **`Create_phyloseq_object.R`** or **`Create_phyloseq_objects_bybiome.R`** first. These scripts convert your raw data into the `phyloseq` format required for network inference.

2.  **Build Networks:**
    * Once `phyloseq` objects are ready, run **`Build_microb_net.R`**, **`Build_microb_net_sp_gen.R`**, or **`Build_microb_nets_based_on_groups.R`**. Choose the appropriate script based on whether you're building a single network, a species/genus-specific network, or a combined network from groups.

---

## ‚öôÔ∏è General Usage & Cluster Submission

Most R scripts in this folder are executed from the command line using `Rscript`. They utilize the `optparse` package for flexible argument passing.

* For a full list of options and their descriptions for any script using `optparse`, run it with the `--help` flag:
    ```bash
    Rscript your_script_name.R --help
    ```

* **Running on a Cluster (using BSUB):**
    The Bash scripts within the `Bash_scripts/` directory are designed for job submission on an LSF cluster system. These scripts set job parameters (queue, name, resources, time limits) and execute the R analysis script with specific arguments. **These Bash scripts are located in subfolders within `Bash_scripts/` (e.g., `Bash_scripts/PGE_sp/`, `Bash_scripts/NOPGE_gen/`).**

    * To submit a job using one of these Bash scripts, use the `bsub` command, pointing to the specific script file. For instance, to run a script for `NOPGE_gen` biome:
        ```bash
        bsub < Bash_scripts/NOPGE_gen/Build_microb_net_NOPGE_gen_cclasso0_1.sh
        ```

---

## üì¶ Input Network Origin

The `microNet` objects generated by these scripts are compatible with the **NetCoMi R package**. They contain an `edgelist` dataframe with columns like `adja`, `asso`, and `diss` which are crucial for subsequent filtering and analysis.